# CVE-2006-2971

## Experiment Environment

Ubuntu 14.04 LTS

## INSTALL & Configuration

```
wget https://github.com/mudongliang/source-packages/raw/master/CVE-2006-2971/0verkill-0.16.tgz

tar -xvf 0verkill-0.16.tgz
0verkill-0.16

./configure
make
```

## Problems in Installation & Configuration

## How to trigger vulnerability

```
./0verkill-0.16/server
python 1894.py localhost 6666
```

## PoCs

[0verkill 0.16 - ASCII-ART Game Remote Integer Overflow Crash (PoC)](https://www.exploit-db.com/exploits/1894/)

## Vulnerability Details & Patch

### Root Cause

```
net.c:94

	if (crc!=crc32(packet,retval-12))return -1;

crc32.c:70

	/* ========================================================================= */
	#define DO1(buf) crc = crc_table[((int)crc ^ (*buf++)) & 0xff] ^ (crc >> 8);
	#define DO2(buf)  DO1(buf); DO1(buf);
	#define DO4(buf)  DO2(buf); DO2(buf);
	#define DO8(buf)  DO4(buf); DO4(buf);
	
	/* ========================================================================= */
	unsigned long crc32(unsigned char* buf, unsigned len)
	{
		unsigned long crc = 0xffffffffL;
		while (len >= 8)
		{
			DO8(buf);
			len -= 8;
		}
		if (len) do {
			DO1(buf);
		} while (--len);
		return crc ^ 0xffffffffL;
	}
```

### Stack Trace

```
(gdb) info stack
#0  crc32 (buf=0x80a5000 <Address 0x80a5000 out of bounds>, len=4294685848) at crc32.c:82
#1  0x0805d08d in recv_packet (packet=0x80604a0 "", max_len=256, addr=0xbf9eabbc, addr_len=0xbf9ea978, 
    sender_server=0, recipient=0, sender=0xbf9ea974) at net.c:94
#2  0x0804d241 in read_data () at server.c:1199
#3  0x08055284 in server () at server.c:2722
#4  0x08055611 in main (argc=1, argv=0xbf9eafb4) at server.c:2780
```

## References
