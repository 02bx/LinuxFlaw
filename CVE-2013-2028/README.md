# CVE-2013-2028

## 实验环境
OS: Ubuntu 14.04 LTS

## 源码安装 Nginx 1.3.9

从 Nginx 下载位置[1]出下载 Nginx 1.3.9.tar.gz，这里注意一下，tar.gz是linux编译所需要的源码，而zip压缩包是给windows定制的。

    $ ./configure
    $ make
    $ sudo make install

### Problems

**1. 缺少pcre library**

>./configure: error: the HTTP rewrite module requires the PCRElibrary. You can either disable the module by using --without-http_rewrite_module option, or install the PCRE library into the system, or build the PCRE library statically from the source with nginx by using --with-pcre=<path> option. 

**解决方案：**

    # sudo apt-get install libpcre3 libpcre3-dev


**2. 缺少zlib 库**

>./configure: error: the HTTP gzip module requires the zlib library. You can either disable the module by using --without-http_gzip_module option, or install the zlib library into the  system, or build the zlib library statically from the source with nginx by using --with-zlib=<path> option.

**解决方案：**

    # sudo apt-get install libssl-dev

安装成功之后，nginx放置在/usr/local/nginx目录下，主要的配置文件为conf目录下的nginx.conf，nginx的启动文件在sbin目录下的nginx文件。

## Nginx 启动

    sudo /usr/local/nginx/sbin/nginx

本地访问 `http://localhost` 测试是否安装成功。

## 漏洞测试

[Nginx HTTP Server 1.3.9-1.4.0 - Chuncked Encoding Stack Buffer Overflow](https://www.exploit-db.com/exploits/25775/)

[nginx 1.3.9-1.4.0 - DoS PoC](https://www.exploit-db.com/exploits/25499/)

## 漏洞 Patch

从邮件列表[2]可获得 Ngnix Patch 的内容:

```
--- src/http/ngx_http_parse.c
+++ src/http/ngx_http_parse.c
@@ -2209,6 +2209,10 @@ data:
 
     }
 
+    if (ctx->size < 0 || ctx->length < 0) {
+        goto invalid;
+    }
+
     return rc;
 
 done:
```

[1] [Nginx 下载位置](http://nginx.org/download/nginx-1.3.9.tar.gz)

[2] [Nginx 邮件列表](http://mailman.nginx.org/pipermail/nginx-announce/2013/000112.html)

[3] [Nginx Patch](http://nginx.org/download/patch.2013.chunked.txt)
